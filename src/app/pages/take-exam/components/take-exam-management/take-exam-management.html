<form [formGroup]="takeExamForm">
  <h2 mat-dialog-title class="headline m-0 text-xl text-accent">
    <strong class="text-am-main-blue-dark">
      @if(data.mode == 'create') { Nuevo examen realizado } @if (data.mode == 'update') {
      Actualizar examen realizado }
    </strong>
  </h2>
  <mat-dialog-content>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
      <app-input-select
        label="Pacientes"
        [mode]="mode"
        placeholder="Seleccionar pacientes"
        [aOptions]="patients$"
        [inputControl]="takeExamForm.get('patientId')"
      />
      <app-input-select
        label="Médicos"
        [mode]="mode"
        placeholder="Seleccionar médicos"
        [aOptions]="medics$"
        [inputControl]="takeExamForm.get('medicId')"
      />
      <app-input-select
        label="Análisis"
        [mode]="mode"
        placeholder="Seleccionar análisis"
        [aOptions]="analysis$"
        [inputControl]="takeExamForm.get('analysisId')"
      />
      <app-input-select
        label="Exámenes"
        [mode]="mode"
        placeholder="Seleccionar exámenes"
        [aOptions]="exams$"
        [inputControl]="takeExamForm.get('examId')"
        [disabled]="!takeExamForm.get('analysisId')?.value"
      />
      <div class="col-span-2 flex justify-center mt-2">
        <button
          type="button"
          (click)="addExamDetail()"
          [disabled]="!takeExamForm.get('analysisId')?.value || !takeExamForm.get('examId')?.value"
          class="flex h-11 items-center px-6 justify-center gap-2 bg-am-main-custom-dark rounded-xl text-white hover:bg-am-main-custom transition"
        >
          <mat-icon class="text-white" fontIcon="add"></mat-icon>
          Agregar examen al detalle
        </button>
      </div>
    </div>

    @if (takeExamDetails.length > 0) {
      <div class="overflow-x-auto mt-4 mb-16">
        <table class="w-full bg-white rounded-3xl">
            <thead class="bg-am-main-blue-dark text-xs uppercase text-white">
              <tr>
                <th class="px-4 py-3 text-left font-semibold rounded-tl-3xl">Análisis</th>
                <th class="px-4 py-3 text-left font-semibold">Examen</th>
                <th class="px-4 py-3 text-center font-semibold w-24 rounded-tr-3xl">Acciones</th>
              </tr>
            </thead>
            <tbody>
              @for (detail of takeExamDetails; track detail) {
                <tr class="border-b border-gray-100 last:border-b-0 hover:bg-am-main-blue-light/10 transition">
                  <td class="px-3 py-1.5 align-middle">{{ getAnalysisDescription(detail.analysisId) }}</td>
                  <td class="px-3 py-1.5 align-middle">{{ getExamDescription(detail.examId, detail.analysisId) }}</td>
                  <td class="px-3 py-1.5 pr-10 text-center align-middle">
                    <button
                      class="rounded-full h-9 w-9 flex items-center justify-center text-am-new-red-dark bg-am-new-red-light border-am-new-red-dark transition shadow"
                      matTooltip="Eliminar"
                      (click)="removeExamDetail(takeExamDetails.indexOf(detail))"
                    >
                      <mat-icon class="flex justify-center items-center w-fit rounded-full " fontIcon="delete"></mat-icon>
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
      </div>
    }
    </mat-dialog-content>

  <mat-dialog-actions>
    <button mat-button mat-dialog-close>Cancelar</button>
    <button
      color="purple"
      class="bg-accent text-accent-contrast"
      mat-button
      (click)="takeExamSave()"
      [disabled]="takeExamForm.invalid"
    >
      Guardar
    </button>
  </mat-dialog-actions>
</form>
